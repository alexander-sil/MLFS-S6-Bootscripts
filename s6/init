#! /bin/execlineb -P

### S6 Init (stage 1)

### Version 3.00

# Set up paths
/bin/export PATH "/usr/bin:/bin:/usr/sbin:/sbin"

/bin/cd /
emptyenv -p
s6-setsid -qb --
umask 022

if { s6-echo -- "\n  Welcome to MLFS with S6" }

if { s6-mount -nwt tmpfs -o mode=0755 tmpfs /run }

# Copy service to /run
if { s6-mkdir /run/boot }
if { s6-hiercopy /etc/s6/run-image /run/boot }

redirfd -r 0     /dev/null
redirfd -wnb 1   /run/boot/service/s6-svscan-log/fifo
fdmove  -c 2 1

# Start Stage 2
background {
  s6-setsid --
  redirfd -w 1   /run/boot/service/s6-svscan-log/fifo
  /etc/s6/stage2 
}

unexport !
s6-svscan -st0 /run/boot/service
