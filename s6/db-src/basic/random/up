#!/bin/execlineb -P

# Setup Random Seed

fdmove -c 2 1

if { s6-echo -- "[      random    ] 1/1 : Generating random seed..." }
foreground {
  cp /var/lib/random-seed /dev/urandom
}

backtick -n bytes { cat /proc/sys/kernel/random/poolsize }
importas -iu bytes bytes
if -t {
        foreground {
                if { s6-test -z $bytes }
                define defbytes 512
                umask 077
                dd if=/dev/urandom of=/var/lib/random-seed count=1 bs=$defbytes 
        }
        s6-true
}

umask 077
foreground { dd if=/dev/urandom of=/var/lib/random-seed count=1 bs=$bytes }


