#! /bin/execlineb -P

fdmove -c 2 1

if { s6-echo -- "[    cleanboot   ] 0/5 : Creating directories ... " }

if -t {
    if { s6-echo -- "[    cleanboot   ] 1/5 : Creating utmp in /run" }
    foreground { install -m0664 -o root -g utmp /dev/null /run/utmp }
}
if -t {
    if -nt { s6-test -e /var/log/wtmp }
    if { s6-echo -- "[    cleanboot   ] 2/5 : Creating utmp in /var/log" }
    foreground { install -m0664 -o root -g utmp /dev/null /var/log/wtmp }
}
if -t {
    if -nt { s6-test -e /var/log/btmp }
    if { s6-echo -- "[    cleanboot   ] 3/5 : Creating btmp in /var/log" }
    foreground { install -m0600 -o root -g utmp /dev/null /var/log/btmp }
}
if -t {
    if { s6-echo -- "[    cleanboot   ] 4/5 : Creating ICE-unix" }
    foreground { install -dm1777 /tmp/.X11-unix /tmp/.ICE-unix }
}
if { s6-echo -- "[    cleanboot   ] 5/5 : Removing filesytem watermarks" }
rm -fv /etc/nologin /forcecheck /forcequotacheck /fastboot 
