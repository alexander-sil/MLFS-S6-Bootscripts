#!/bin/execlineb -P

fdmove -c 2 1
importas -i S6CONF S6CONF
/bin/export PATH "/sbin:/bin:/usr/sbin:/usr/bin"
s6-envdir ${S6CONF}
importas -D "" FORCECHCK FORCECHCK
ifelse -X { s6-test $FORCECHCK = yes }
        {
                redirfd -w 1 /dev/console
                if { s6-echo -- Check of filesystem was asked, please wait }
                foreground { /sbin/fsck -A -T -a -f noopts=_netdev }
                s6-echo -- Filesystem checked
}

# if partition is checked, fsck return a fail exit
# and a crash occurs, so whatever happens with fsck, the output need to be a success
if -t {
    if { s6-echo -- checkfs-fsckeck started }
    /sbin/fsck -A -T -a noopts=_netdev
}
s6-echo -- checkfs-fscheck successfully started
